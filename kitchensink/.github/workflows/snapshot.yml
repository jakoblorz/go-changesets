name: Snapshot

on:
  workflow_dispatch:
    inputs:
      project:
        description: "Project name (leave empty for all projects with changesets)"
        required: false
        type: string
      branch:
        description: "Branch to create snapshot from"
        required: false
        default: "canary"
        type: string

permissions:
  contents: write

concurrency:
  group: snapshot-${{ inputs.branch || 'canary' }}
  cancel-in-progress: false

env:
  GOPRIVATE: github.com/jakoblorz

jobs:
  snapshot:
    uses: ./.github/workflows/snapshot.yml
    with:
      snapshot_branch: ${{ inputs.branch || 'canary' }}
      snapshot_project: ${{ inputs.project }}
    secrets:
      snapshot_token: ${{ secrets.CI_PAT_TO_TRIGGER_RELEASE_ACTION }}
