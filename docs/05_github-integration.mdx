---
title: GitHub Actions Integration
description: Automate version PRs and GitHub releases.
---

# GitHub Actions Integration

Automate your entire release workflow with GitHub Actions. This guide shows you how to set up continuous delivery for your Go monorepo using `go-changeset`.

## Overview

The automated workflow consists of two main jobs:

1. **Version PRs** - Automatically create per-project pull requests when changesets are merged
2. **Publish** - Automatically create GitHub releases when version PRs are merged

```
Developer workflow          CI/CD automation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Add changeset     â”€â”€â†’  Merge to main
     â†“                       â†“
Commit & push           Detect changesets
     â†“                       â†“
Create PR               Create version PR(s)
     â†“                       â†“
Get approved            Review version PR
     â†“                       â†“
Merge to main           Merge version PR
                             â†“
                        Publish GitHub release
                             â†“
                        Users get new version! ðŸŽ‰
```

## The Two-Phase Release Process

### Source of Truth

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SOURCE OF TRUTH                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  version.txt (PR branch) = Staged version        â”‚
â”‚  git tags (main branch)  = Published version     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Phase 1: Staging (Version PR)**
- Changesets exist in main
- CI runs `changeset version`
- Updates version.txt and CHANGELOG.md
- Creates PR for review
- **NOT yet published**

**Phase 2: Publishing (After merge)**
- version.txt > git tag (outdated)
- CI runs `changeset publish`
- Creates git tag and GitHub release
- **NOW published**

This two-phase approach provides:
- âœ… **Review gate** - Versions reviewed before publishing
- âœ… **Rollback safety** - Can abandon version PR without consequences
- âœ… **Clarity** - Clear separation between staging and production

**Bonus: Relationship Tracking**

The workflow also includes changeset relationship detection:
- `changeset tree` analyzes which changesets were created together
- Related PRs are automatically linked in their descriptions
- Helps reviewers understand multi-project changes

Learn more: [Changeset Groups](./changeset-groups.mdx)

## Complete Setup

### Prerequisites

Your repository must have:

- âœ… `go.work` file at repository root
- âœ… One or more Go modules with `go.mod` files
- âœ… `.changeset/` directory (auto-created by `changeset add`)
- âœ… GitHub repository with Actions enabled

### Directory Structure

```
my-monorepo/
â”œâ”€â”€ go.work                  # Workspace definition
â”œâ”€â”€ .changeset/              # Changesets directory
â”‚   â”œâ”€â”€ .gitkeep
â”‚   â””â”€â”€ *.md                 # Changeset files
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ go.mod
â”‚   â”‚   â”œâ”€â”€ version.txt      # Created by version command
â”‚   â”‚   â””â”€â”€ CHANGELOG.md     # Generated automatically
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ go.mod
â”‚       â”œâ”€â”€ version.txt
â”‚       â””â”€â”€ CHANGELOG.md
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ changeset.yml    # Main release workflow
        â””â”€â”€ snapshot.yml     # RC workflow (optional)
```

### Main Workflow File

Create `.github/workflows/changeset.yml`:

```yaml
name: Changesets

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# Permissions needed for creating PRs and releases
permissions:
  contents: write
  pull-requests: write

jobs:
  # Job 1: Create per-project version PRs
  version-prs:
    name: Create Per-Project PRs
    runs-on: ubuntu-latest
    # Only run on main branch pushes
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Need full history for git operations

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.24"

      - name: Install go-changeset
        run: go install github.com/jakoblorz/go-changesets/cmd/changeset@latest

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create per-project PRs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          changeset each --filter open-changesets -- sh -c '
            set -e
            
            BRANCH="changeset-release/$PROJECT"
            
            echo "ðŸ“¦ Creating PR for $PROJECT..."
            
            git checkout -b "$BRANCH" 2>/dev/null || git checkout "$BRANCH"
            
            changeset version
            
            if git diff --quiet && git diff --cached --quiet; then
              echo "âš ï¸  No changes to commit for $PROJECT"
              git checkout main
              exit 0
            fi
            
            VERSION=$(cat "$PROJECT_PATH/version.txt" 2>/dev/null || echo "unknown")
            
            git add .
            git commit -m "chore: version $PROJECT to $VERSION"
            git push -u origin "$BRANCH" --force
            
            PR_BODY="This PR was automatically generated for **$PROJECT**.

          ## ðŸ“‹ Changes

          $CHANGELOG_PREVIEW

          ## ðŸ“¦ What happens when you merge?
          - Version bumped to **$VERSION**
          - Changelog updated
          - Changesets consumed
          - Publish workflow creates GitHub release: \`$PROJECT@v$VERSION\`"
            
            gh pr create \
              --title "ðŸš€ Release $PROJECT v$VERSION" \
              --body "$PR_BODY" \
              --head "$BRANCH" \
              --base main \
              --label "release" \
              --label "automated" \
              || gh pr edit "$BRANCH" --title "ðŸš€ Release $PROJECT v$VERSION"
            
            git checkout main
            git reset --hard origin/main
            git clean -fd
            
            echo "âœ… PR created/updated for $PROJECT"
          '

      - name: Summary
        run: |
          echo "## ðŸŽ‰ Release PRs Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Per-project release PRs have been created." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "View pull requests: https://github.com/${{ github.repository }}/pulls" >> $GITHUB_STEP_SUMMARY

  # Job 2: Publish releases when version PRs are merged
  publish:
    name: Publish Releases
    runs-on: ubuntu-latest
    # Only run on main branch pushes
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Need full history for git tags

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.24"

      - name: Install go-changeset
        run: go install github.com/jakoblorz/go-changesets/cmd/changeset@latest

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Check for outdated versions
        id: check_publish
        run: |
          # Check if any projects have version.txt > git tag
          if changeset each --filter outdated-versions -- echo "found" 2>/dev/null | grep -q "found"; then
            echo "has_outdated=true" >> $GITHUB_OUTPUT
          else
            echo "has_outdated=false" >> $GITHUB_OUTPUT
          fi

      - name: Publish releases
        if: steps.check_publish.outputs.has_outdated == 'true'
        run: |
          # Publish all projects where version.txt > git tag
          changeset each --filter outdated-versions -- \
            changeset publish \
              --owner ${{ github.repository_owner }} \
              --repo ${{ github.event.repository.name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Summary
        if: steps.check_publish.outputs.has_outdated == 'true'
        run: |
          echo "## ðŸŽ‰ Releases Published" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "GitHub releases have been created." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "View releases: https://github.com/${{ github.repository }}/releases" >> $GITHUB_STEP_SUMMARY
```

## How the Workflow Works

The workflow consists of **three steps** when using changeset relationship tracking:

### Step 1: Analyze Relationships (Optional but Recommended)

Before versioning deletes changeset files, capture which changesets are related:

```yaml
- name: Analyze changeset relationships
  run: |
    changeset tree --filter open-changesets --format json > /tmp/tree.json
    changeset tree --filter open-changesets  # Show in logs
```

This saves relationship data for Step 3 (PR linking). Learn more about [changeset groups](./changeset-groups.mdx).

### Step 2: Version PRs (Per-Project)

This step creates **separate PRs for each project** with changesets:

```bash
changeset each --filter open-changesets -- sh -c '
  # 1. Create branch for this project
  BRANCH="changeset-release/$PROJECT"
  git checkout -b "$BRANCH"
  
  # 2. Run version command (updates files)
  changeset version
  
  # 3. Capture new version AFTER version command
  VERSION=$(cat "$PROJECT_PATH/version.txt")
  
  # 4. Commit and push
  git add .
  git commit -m "chore: version $PROJECT to $VERSION"
  git push -u origin "$BRANCH" --force
  
  # 5. Create PR with changelog preview
  gh pr create \
    --title "Release $PROJECT v$VERSION" \
    --body "## Changes\n\n$CHANGELOG_PREVIEW" \
    --head "$BRANCH"
  
  # 6. Reset for next project (isolation!)
  git checkout main
  git reset --hard origin/main
  git clean -fd
'
```

**Key Points:**

**Branch Creation FIRST:**
- Must create branch before making changes
- Branch name: `changeset-release/{project}`

**VERSION Captured AFTER:**
- `changeset version` updates version.txt
- Then we read the NEW version
- Critical for correct commit messages and PR titles

**Git Reset for Isolation:**
- Each iteration starts from clean main
- Changes from one project don't leak into another
- Enables per-project PRs

**Changelog Preview:**
- `$CHANGELOG_PREVIEW` automatically set by `changeset each`
- Contains formatted changelog content
- No parsing needed - ready for PR body

**PR Number Tracking:**
- Save PR numbers to `/tmp/pr-mapping.txt`
- Format: `project=PR_NUMBER`
- Used in Step 3 for linking related PRs

### Step 3: Link Related PRs (Optional)

After PRs are created, link related ones together:

```bash
# Parse tree and PR mapping
jq -c '.groups[]' /tmp/tree.json | while read -r group; do
  # For each group with multiple projects:
  # - Get all PR numbers from mapping file
  # - Build relationship section
  # - Update each PR body with links to related PRs
done
```

This adds a "Related Release PRs" section to each PR showing which other PRs are part of the same feature.

See the complete implementation in [kitchensink/.github/workflows/changeset.yml](../kitchensink/.github/workflows/changeset.yml).

### Step 4: Publish Releases

This job publishes GitHub releases for projects that have been versioned:

```bash
# For each project where version.txt > git tag
changeset each --filter outdated-versions -- \
  changeset publish --owner $OWNER --repo $REPO
```

**Trigger:**
- Runs on every push to main
- Checks if any projects are "outdated" (version.txt > latest tag)
- If yes, publishes those projects

**What it does:**
- Creates git tag: `project@v{version}`
- Pushes tag to remote
- Creates GitHub release with changelog from CHANGELOG.md
- Attaches changelog notes to release

## Per-Project PRs vs Single PR

The workflow above creates **separate PRs for each project**. 

### Benefits of Per-Project PRs

âœ… **Independent review** - Each project reviewed and merged separately  
âœ… **Selective releases** - Merge only projects ready for production  
âœ… **Parallel workflows** - Multiple team members work on different releases  
âœ… **Isolated failures** - One project's issues don't block others  
âœ… **Clear history** - Each project has dedicated release commit  
âœ… **Faster iterations** - Don't wait for all projects to be ready

### Example

```
Changesets merged:
  - auth: 2 changesets (minor + patch)
  - api: 1 changeset (minor)
  - shared: 3 changesets (patch + patch + patch)

CI creates 3 separate PRs:
  â”œâ”€ PR #123: Release auth v1.2.0
  â”œâ”€ PR #124: Release api v2.1.0
  â””â”€ PR #125: Release shared v0.5.1

You can:
  - Merge auth PR â†’ auth published
  - Hold api PR â†’ needs more testing
  - Merge shared PR â†’ shared published
```

### Alternative: Single PR for All Projects

If you prefer **one PR for all projects**, use a simpler approach:

```yaml
- name: Version all projects
  run: |
    changeset each --filter open-changesets -- changeset version

- name: Create Pull Request
  uses: peter-evans/create-pull-request@v5
  with:
    token: ${{ secrets.GITHUB_TOKEN }}
    commit-message: "Version packages"
    title: "ðŸš€ Release: Version Updates"
    branch: changeset-release
    body: |
      Automated version updates for all projects with changesets.
      
      Review version.txt and CHANGELOG.md changes before merging.
```

**Tradeoffs:**
- âœ… Simpler (less shell scripting)
- âœ… All projects released together
- âŒ All-or-nothing (can't merge selectively)
- âŒ One project's issues block all others

## Environment Variables

### Set Automatically by `changeset each`

When you use `changeset each`, these variables are available to your command:

```bash
$PROJECT              # Project name (e.g., "auth")
$PROJECT_PATH         # Absolute path (e.g., "/home/runner/work/repo/packages/auth")
$CURRENT_VERSION      # Version from version.txt (e.g., "1.2.0")
$LATEST_TAG           # Latest git tag (e.g., "1.1.5")
$CHANGELOG_PREVIEW    # Formatted changelog content (NEW!)
$CHANGESET_CONTEXT    # Full JSON context
```

### Using CHANGELOG_PREVIEW

The `$CHANGELOG_PREVIEW` variable contains **pre-formatted changelog content** - perfect for PR descriptions:

```bash
changeset each --filter open-changesets -- sh -c '
  gh pr create --body "## Changes

$CHANGELOG_PREVIEW

## What happens when you merge?
- Version bumped to v$(cat $PROJECT_PATH/version.txt)
- Release created"
'
```

**Example PR body:**
```markdown
## Changes

### Minor Changes

- Add OAuth2 authentication support with Google and GitHub providers
- Implement automatic token refresh mechanism

### Patch Changes

- Fix memory leak in session cleanup handler

## What happens when you merge?
- Version bumped to v1.2.0
- Release created
```

**No parsing needed!** The changelog is pre-formatted and ready to use.

### Required Environment Variables

```yaml
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # For publish/snapshot
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}      # For gh CLI (PR creation)
```

## Complete Workflow Walkthrough

Let's trace through what happens in the automated workflow:

### Scenario: Developer Adds OAuth2 Feature

**1. Developer creates changeset and merges PR**
```bash
git checkout -b feature/oauth2
vim packages/auth/oauth.go

changeset add
# Select: auth
# Bump: minor
# Message: "Add OAuth2 authentication support"

git add .
git commit -m "feat: add OAuth2"
git push

# PR created, reviewed, and merged to main
```

**2. GitHub Actions detects changeset (on push to main)**
```yaml
# Workflow triggers
# Checks: Any changesets in .changeset/?
# Result: Yes - dazzling_mouse_abc123.md found
```

**3. CI creates version PR**
```bash
# Runs: changeset each --filter open-changesets -- changeset version

Branch created: changeset-release/auth
Files modified:
  - packages/auth/version.txt: 1.1.0 â†’ 1.2.0
  - packages/auth/CHANGELOG.md: (new entry added)
  - .changeset/dazzling_mouse_abc123.md: (deleted)

PR created: "ðŸš€ Release auth v1.2.0"
PR body: (includes $CHANGELOG_PREVIEW content)
```

**4. Maintainer reviews version PR**
```markdown
**Review checklist:**
- âœ… Version bump correct? (1.1.0 â†’ 1.2.0 âœ“)
- âœ… Changelog entry readable? (Yes âœ“)
- âœ… Changesets consumed? (Yes âœ“)

**Action:** Merge PR
```

**5. GitHub Actions publishes release (on merge to main)**
```bash
# Workflow detects: version.txt (1.2.0) > git tag (1.1.0)
# Runs: changeset publish --project auth

Git tag created: auth@v1.2.0
GitHub release created: auth@v1.2.0
Release notes: (from CHANGELOG.md)
```

**6. Users get the new version**
```bash
# Appears in GitHub Releases
https://github.com/yourorg/yourrepo/releases/tag/auth@v1.2.0

# Available via go get
go get github.com/yourorg/yourrepo/packages/auth@v1.2.0
```

## Preventing Duplicate PRs

The workflow includes safety mechanisms to prevent duplicate or obsolete release PRs:

**Concurrency Control:**
```yaml
concurrency:
  group: changeset-${{ github.ref }}
  cancel-in-progress: false
```

This queues workflow runs when multiple PRs are merged quickly, preventing race conditions.

**Obsolete PR Cleanup:**

After creating/linking PRs, the workflow automatically closes any release PRs that are no longer needed:

```bash
# For projects with no changesets
changeset each --filter unchanged -- sh -c '
  # If release PR exists for this project, close it
  # (No changesets = PR is obsolete or already merged)
'
```

This handles the case where a version PR was merged during the workflow run, preventing duplicate or stale PRs from remaining open.

## Workflow Customization

### Customizing PR Title and Body

Edit the `gh pr create` section:

```bash
gh pr create \
  --title "ðŸš€ Release $PROJECT v$VERSION" \
  --body "## ðŸ“‹ Changelog

$CHANGELOG_PREVIEW

## ðŸ“¦ Release Information
- **Project:** $PROJECT
- **Version:** $VERSION
- **Tag:** \`$PROJECT@v$VERSION\`

## âœ… Review Checklist
- [ ] Version bump is correct
- [ ] Changelog entries are accurate
- [ ] All tests passing

## ðŸš€ After Merging
This will trigger the publish workflow to create a GitHub release.

---
*Automated by [go-changeset](https://github.com/jakoblorz/go-changesets)*" \
  --head "$BRANCH" \
  --base main \
  --label "release" \
  --label "automated"
```

### Adding More Labels

```bash
gh pr create \
  --label "release" \
  --label "automated" \
  --label "$PROJECT"  # Add project name as label
  --label "ready-for-review"
```

### Custom Branch Naming

```bash
# Instead of "changeset-release/auth"
BRANCH="release/$PROJECT/v$VERSION"  # "release/auth/v1.2.0"
BRANCH="releases/$PROJECT"           # "releases/auth"
BRANCH="bump-$PROJECT"               # "bump-auth"
```

### Notifications

Add Slack/Discord notifications:

```yaml
- name: Notify Slack
  if: steps.check_publish.outputs.has_outdated == 'true'
  uses: slackapi/slack-github-action@v1
  with:
    payload: |
      {
        "text": "New releases published! Check https://github.com/${{ github.repository }}/releases"
      }
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

## Filters Deep Dive

### open-changesets

Projects that have changesets in `.changeset/`:

```bash
changeset each --filter open-changesets -- <command>
```

**Use cases:**
- Creating version PRs
- Listing projects that need releasing
- Running commands only for changed projects

### outdated-versions

Projects where `version.txt` > latest git tag:

```bash
changeset each --filter outdated-versions -- <command>
```

**Use cases:**
- Publishing releases
- Finding projects that were versioned but not yet published
- Detecting what needs publishing

### has-version

Projects with a `version.txt` file:

```bash
changeset each --filter has-version -- <command>
```

**Use cases:**
- Running commands only on release-ready projects
- Excluding projects without versions
- Listing all versionable projects

### no-version

Projects without `version.txt` (or version.txt = "false"):

```bash
changeset each --filter no-version -- <command>
```

**Use cases:**
- Finding projects that haven't been set up yet
- Initializing new projects
- Reporting on project status

### Combining Commands with Filters

```bash
# List all projects with versions
changeset each --filter has-version -- \
  bash -c 'echo "$PROJECT: v$CURRENT_VERSION (tag: $LATEST_TAG)"'

# Find projects that need publishing
changeset each --filter outdated-versions -- \
  bash -c 'echo "$PROJECT needs publishing: $CURRENT_VERSION > $LATEST_TAG"'

# Preview changelogs for all projects with changesets
changeset each --filter open-changesets -- changeset changelog
```

## Advanced Scenarios

### Multi-Project Coordinated Release

Release multiple projects together:

```yaml
- name: Version projects together
  run: |
    # Version all at once
    changeset each --filter open-changesets -- changeset version
    
    # Single PR for all projects
- uses: peter-evans/create-pull-request@v5
  with:
    title: "ðŸš€ Coordinated Release"
    body: "Releasing auth, api, and shared together"
```

### Selective Publishing

Publish only specific projects:

```yaml
- name: Publish backend services only
  run: |
    changeset publish --project auth --owner $OWNER --repo $REPO
    changeset publish --project api --owner $OWNER --repo $REPO
    # Skip frontend projects for now
```

### Conditional Workflows

```yaml
- name: Version frontend projects
  if: contains(github.event.head_commit.message, '[frontend]')
  run: |
    changeset version --project web
    changeset version --project mobile
```

### Custom Filters

```bash
# Projects starting with "service-"
changeset each --filter all -- bash -c '
  if [[ "$PROJECT" == service-* ]]; then
    changeset version
  fi
'
```

## Snapshot Workflow (Optional)

For teams that need RC testing before merging to main:

Create `.github/workflows/snapshot.yml`:

```yaml
name: Release Candidate Snapshot

on:
  workflow_dispatch:
    inputs:
      project:
        description: 'Project name (leave empty for all)'
        required: false
        type: string
      branch:
        description: 'Branch name'
        required: false
        default: 'canary'
        type: string

permissions:
  contents: write

jobs:
  snapshot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch }}
          fetch-depth: 0

      - uses: actions/setup-go@v4
        with:
          go-version: "1.24"

      - run: go install github.com/jakoblorz/go-changesets/cmd/changeset@latest

      - run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create Snapshot
        run: |
          if [ -z "${{ inputs.project }}" ]; then
            changeset each --filter open-changesets -- \
              changeset snapshot --owner ${{ github.repository_owner }} \
                --repo ${{ github.event.repository.name }}
          else
            changeset snapshot --project "${{ inputs.project }}" \
              --owner ${{ github.repository_owner }} \
              --repo ${{ github.event.repository.name }}
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**Usage:**
```
Actions > Release Candidate Snapshot > Run workflow
  Branch: canary
  Project: (empty for all)
```

Learn more in [Snapshot Releases](./snapshotting.mdx).

## Developer Experience

### What Developers See

**Adding a changeset:**
```bash
$ changeset add

# Beautiful TUI appears
# Select projects, choose bump, write message
# Changeset created!

$ git add .changeset/
$ git commit -m "feat: add OAuth2"
$ git push
```

**After merge:**
- GitHub bot comments: "âœ… Version PR created: #123"
- PR appears: "ðŸš€ Release auth v1.2.0"
- Includes full changelog in description

**After version PR merge:**
- GitHub release appears automatically
- Users can install new version immediately

### What Maintainers See

**Version PR Review:**
```diff
Files changed:
+ packages/auth/version.txt
  1.1.0 â†’ 1.2.0

+ packages/auth/CHANGELOG.md
  ## 1.2.0 (2024-11-16)
  
  ### Minor Changes
  - Add OAuth2 authentication support

- .changeset/dazzling_mouse_abc123.md
  (deleted)
```

**Review checklist:**
- âœ… Version bump appropriate?
- âœ… Changelog readable?
- âœ… Tests passing?

**Action:** Merge PR â†’ Release automatically published!

## Troubleshooting

### Version PR Not Created

**Symptom:** Pushed changesets to main, but no PR appeared

**Checks:**
```bash
# Are changesets actually in main?
git ls-files .changeset/*.md

# Check workflow logs
# GitHub > Actions > Changesets > Latest run

# Verify permissions in workflow
permissions:
  contents: write
  pull-requests: write
```

**Solution:**
```bash
# Manually create version PR
git checkout -b changeset-release/auth
changeset version --project auth
git add .
git commit -m "chore: version auth"
git push origin changeset-release/auth
gh pr create --title "Release auth"
```

### Release Not Published

**Symptom:** Merged version PR, but no GitHub release created

**Checks:**
```bash
# Is version.txt > git tag?
cat packages/auth/version.txt  # 1.2.0
git tag -l "auth@v*" | sort -V | tail -1  # auth@v1.1.0

# Check workflow logs
# Verify GITHUB_TOKEN has permissions
```

**Solution:**
```bash
# Manually publish
export GITHUB_TOKEN=your_token
changeset publish --project auth --owner org --repo repo
```

### Multiple PRs Have Conflicts

**Symptom:** Two version PRs conflict with each other

**Cause:** Both PRs modified the same changeset files

**Solution:**
```bash
# Update one PR with latest main
git checkout changeset-release/auth
git merge main
git push origin changeset-release/auth --force

# Or close one PR and re-run workflow
```

### Wrong Version Calculated

**Symptom:** Version PR shows unexpected version bump

**Cause:** Multiple changesets with different bump types

**Fix:**
```bash
# Check what changesets exist for project
ls .changeset/*.md | xargs grep "auth:"

# Version uses highest bump type
# If you see: patch, minor, patch
# Result: minor (highest)

# If wrong, edit changesets before merging:
vim .changeset/dazzling_mouse_abc123.md
# Change bump type in frontmatter
```

### PR Body Missing Changelog

**Symptom:** PR body doesn't show changelog content

**Cause:** `$CHANGELOG_PREVIEW` not set or empty

**Check:**
```bash
# Test locally
changeset each --filter open-changesets -- sh -c 'echo "$CHANGELOG_PREVIEW"'

# Should output formatted changelog
# If empty, check if changesets exist
```

### Workflow Runs on Every Push

**Symptom:** CI runs even when no changesets exist

**Expected behavior:** This is normal! The workflow checks for changesets and exits early if none found.

**To skip entirely:**
```yaml
# Add path filter
on:
  push:
    branches: [main]
    paths:
      - '.changeset/**'  # Only run if changesets changed
```

## Best Practices

### 1. Protect Main Branch

```yaml
# GitHub Settings > Branches > Branch protection rules
Required:
  âœ… Require pull request reviews (1 reviewer)
  âœ… Require status checks to pass
  âœ… Require branches to be up to date
```

This ensures:
- Version PRs are reviewed before merge
- Tests pass before publishing
- No accidental direct pushes to main

### 2. Use Draft PRs for WIP Releases

```bash
gh pr create \
  --draft \  # Create as draft
  --title "Release $PROJECT v$VERSION"
```

Mark as ready when you've reviewed the changes.

### 3. Squash Version PRs

```yaml
# GitHub Settings > Pull Requests
âœ… Allow squash merging
âŒ Allow merge commits
âŒ Allow rebase merging
```

This keeps git history clean with one commit per release.

### 4. Add CODEOWNERS for Changesets

```
# .github/CODEOWNERS
.changeset/  @your-team/maintainers
```

Ensures maintainers review all changesets.

### 5. Require Changesets in PRs

Add a check to your CI:

```yaml
- name: Check for changeset
  run: |
    # Skip for certain PR labels
    if [[ "${{ contains(github.event.pull_request.labels.*.name, 'skip-changeset') }}" == "true" ]]; then
      echo "Skipping changeset check (skip-changeset label)"
      exit 0
    fi
    
    # Check if PR adds changesets
    if ! git diff origin/main --name-only | grep -q "^\.changeset/.*\.md$"; then
      echo "âŒ No changeset found. Add one with: changeset add"
      exit 1
    fi
```

### 6. Monitor Release Workflow

Set up alerts for failed releases:

```yaml
- name: Notify on Failure
  if: failure()
  uses: slackapi/slack-github-action@v1
  with:
    payload: |
      {
        "text": "âš ï¸ Release workflow failed! Check ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
      }
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

## Manual Operations

### Testing Workflows Locally

You can test the workflow steps locally before pushing:

```bash
# 1. Check for changesets
ls .changeset/*.md

# 2. Preview what version would do
changeset changelog --project auth

# 3. Run version (on a branch)
git checkout -b test-version
changeset version --project auth
git diff  # Review changes

# 4. Test publish (dry run)
changeset publish --project auth --owner org --repo repo
# (Make sure you're ok with creating a release!)

# 5. Clean up test branch
git checkout main
git branch -D test-version
```

### Manual Release Process

If CI is down or you need to release manually:

```bash
# 1. Version the project
git checkout -b release-auth
changeset version --project auth

# 2. Review changes
git diff packages/auth/

# 3. Commit
git add .
git commit -m "chore: version auth to 1.2.0"

# 4. Push and create PR
git push origin release-auth
gh pr create --title "Release auth v1.2.0"

# 5. After PR merge, publish
git checkout main
git pull
export GITHUB_TOKEN=your_token
changeset publish --project auth --owner org --repo repo
```

## Example Workflows

### Monorepo with Frontend and Backend

```yaml
version-prs:
  # ... setup steps ...
  
  - name: Version backend services
    run: |
      # Only version Go services (skip frontend)
      changeset each --filter open-changesets -- sh -c '
        if [[ "$PROJECT" == backend-* ]] || [[ "$PROJECT" == api ]]; then
          # ... version and create PR ...
        fi
      '
```

### Scheduled Weekly Releases

```yaml
on:
  schedule:
    - cron: '0 10 * * MON'  # Every Monday at 10am
  workflow_dispatch:  # Also allow manual trigger

jobs:
  weekly-release:
    # ... version all projects with changesets ...
```

### Multi-Environment Deployment

```yaml
publish:
  # ... publish steps ...
  
  - name: Deploy to staging
    run: |
      # Deploy newly published versions to staging
      kubectl set image deployment/auth auth=ghcr.io/org/auth:v$VERSION
  
  - name: Create production deployment PR
    run: |
      # Create PR to update production manifests
      # Requires manual approval before prod deploy
```

## Reference

### Workflow Triggers

```yaml
# On every push to main
on:
  push:
    branches: [main]

# Manual trigger
on:
  workflow_dispatch:

# On PR creation (for checks)
on:
  pull_request:
    branches: [main]

# Scheduled
on:
  schedule:
    - cron: '0 10 * * MON'

# Multiple triggers
on:
  push:
    branches: [main]
  workflow_dispatch:
  pull_request:
    branches: [main]
```

### Permissions

```yaml
permissions:
  contents: write        # For creating tags and releases
  pull-requests: write   # For creating version PRs
  packages: write        # If publishing to GitHub Packages (optional)
```

### Git Configuration

Always configure git identity for commits:

```bash
git config user.name "github-actions[bot]"
git config user.email "github-actions[bot]@users.noreply.github.com"
```

### GitHub CLI Authentication

The `gh` CLI needs authentication for PR creation:

```yaml
env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  # or
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

Both work - `gh` checks both environment variables.

## Security Considerations

### Token Permissions

The `GITHUB_TOKEN` needs:
- âœ… `contents: write` - For tags and releases
- âœ… `pull-requests: write` - For creating PRs

**Default `secrets.GITHUB_TOKEN` has these permissions** when explicitly requested in `permissions:` block.

### Preventing Secrets in Changelogs

Add a check to prevent secrets in changeset messages:

```yaml
- name: Check changesets for secrets
  run: |
    if grep -r "ghp_\|github_pat_" .changeset/; then
      echo "âŒ Potential secret found in changeset!"
      exit 1
    fi
```

### Rate Limiting

GitHub API has rate limits. For large monorepos:

```yaml
# Add delays between publishes
- run: |
    changeset each --filter outdated-versions -- sh -c '
      changeset publish --owner $OWNER --repo $REPO
      sleep 2  # Avoid rate limiting
    '
```

## Monitoring and Observability

### GitHub Actions Summary

Both jobs write to `$GITHUB_STEP_SUMMARY` for visibility:

```bash
echo "## ðŸŽ‰ Release PRs Created" >> $GITHUB_STEP_SUMMARY
echo "- auth v1.2.0" >> $GITHUB_STEP_SUMMARY
echo "- api v2.0.0" >> $GITHUB_STEP_SUMMARY
```

### Workflow Artifacts

Save version information:

```yaml
- name: Save version info
  run: |
    changeset each --filter outdated-versions -- \
      bash -c 'echo "$PROJECT: $CURRENT_VERSION" >> versions.txt'

- uses: actions/upload-artifact@v3
  with:
    name: released-versions
    path: versions.txt
```

### Notifications

Add notifications for successful releases:

```yaml
- name: Comment on PRs
  run: |
    # Find PRs that were merged with changesets
    # Comment with release link
    gh pr comment $PR_NUMBER --body "ðŸŽ‰ Released in auth@v1.2.0"
```

## Getting Help

If you encounter issues:

1. **Check workflow logs** - GitHub Actions > Changesets > Latest run
2. **Test commands locally** - Run `changeset` commands on your machine
3. **Review documentation** - Each command has `--help`
4. **Check repository issues** - Known issues and solutions
5. **Ask for help** - GitHub Discussions

## Next Steps

- Copy the workflow files to your repository
- Customize PR templates and notifications
- Set up branch protection rules
- Test the workflow with a changeset
- Review the [complete example in kitchensink](../kitchensink/.github/workflows/)

---

**See also:**
- [Adding Changesets](./adding-a-changeset.mdx) - How contributors add changesets
- [Introduction to Changesets](./intro-to-using-changesets.mdx) - Core concepts
- [Changeset Groups](./changeset-groups.mdx) - Understanding related changesets
- [Snapshot Releases](./snapshotting.mdx) - RC testing workflow
